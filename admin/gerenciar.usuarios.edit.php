<?php	acessoDireto( "ADMINISTRADOR;ASSOCIADO;GUEST;" );		$row = mysql_query("SELECT login.CODLOGIN, DATE_FORMAT( login.DTA, '%d/%m/%Y, %Hh%i.' ) as DTA, login.LOGIN, login.SENHA, login.PAPEL, login.OWNER, login.STATUS, pessoa.EMAIL, pessoa.NOME FROM login INNER JOIN login_rel_pessoa ON login.CODLOGIN=login_rel_pessoa.CODLOGIN INNER JOIN pessoa ON pessoa.CODPESSOA=login_rel_pessoa.CODPESSOA WHERE login.CODLOGIN='$_GET[id]' GROUP BY login.CODLOGIN");	if(mysql_num_rows($row) != 0 )	{		$row = mysql_fetch_object( $row );	}		$erro = "";	$controlar = true;		if ( !empty($_POST) && isset($_POST['ACTION']) )  	{				$controlar = false;		$codlogin = $_GET['id'];				$cod = mysql_query("SELECT * FROM login_rel_pessoa WHERE CODLOGIN='$_GET[id]'");		if(mysql_num_rows($cod) != 0 )		{			$cod = mysql_fetch_object($cod);			$codpessoa = $cod->CODPESSOA;		}				$nome = trim( htmlentities( tratapost($_POST["nome"]) ) );		$senha  = trim( tratapost($_POST["senha"]) );		$repetirsenha = trim( tratapost($_POST["repetirsenha"]) );		$email = trim( tratapost($_POST["email"]) );				$status = trim( tratapost($_POST["status"]) );		$administrador = trim( tratapost($_POST["ADMINISTRADOR"]));		$gerente = tratapost($_POST['GERENTE']);		$guest = trim( tratapost($_POST["GUEST"]));		$isitem = tratapost($_POST["ISITEM"]);				if ( ( $nome == "" || substr_count( $nome, " ") == 0 )  && $erro == ""  ) 		{			$erro = "<br/>* Preencha seu <b>\"Nome\"</b> completo!";		} 		elseif ( ( substr_count( $email, ".") == 0 || substr_count( $email, "@") != 1 ) && $erro == "" ) 		{			$erro = "<br/>* Formato de <b>\"E-mail\"</b> inv·lido!";		} 				if ( $erro == '' ) 		{						( $status == 'on' ) ? $status = 1 : $status = 0;			( $administrador == 'on' ) ? $administrador = "ADMINISTRADOR;" : $administrador = "";			( $gerente == 'on' ) ? $gerente = "GERENTE;" : $gerente = "";			( $guest == 'on' ) ? $guest = "GUEST;" : $guest = "";						$senha = strtoupper( md5( $_POST["senha"] ) );			$dta   = getTimestamp();						$existelogin = mysql_query("SELECT LOGIN FROM login WHERE LOGIN='$row->LOGIN'");			$existemail   = mysql_query("SELECT EMAIL FROM pessoa WHERE EMAIL='$email'");						//aqui ele manteve o login			if ( $row->EMAIL == $email && $row->LOGIN == $row->LOGIN ) 			{							if( $isitem == '0' )				{									mysql_query("UPDATE login SET DTA=CURRENT_TIMESTAMP, SENHA='$senha', PAPEL='$administrador$gerente$guest', STATUS='$status', OWNER='$_SESSION[CODPESSOA]' WHERE CODLOGIN='$codlogin'");								}				else				{										mysql_query("UPDATE login SET DTA=CURRENT_TIMESTAMP, PAPEL='$administrador$gerente$guest', STATUS='$status', OWNER='$_SESSION[CODPESSOA]' WHERE CODLOGIN='$codlogin'");								}								mysql_query("UPDATE pessoa SET DTA=CURRENT_TIMESTAMP, NOME='$nome', OWNER='$_SESSION[CODPESSOA]' WHERE CODPESSOA IN( SELECT E.CODPESSOA FROM login_rel_pessoa as E WHERE E.CODLOGIN='$codlogin')");				echo "<script>alert('* ".getLabel('LABEL_EDIT_SUCESSO_LABEL', $_SESSION['LANGUAGE'])."!')</script>";				echo "<script>window.location = 'index.php?actionType=gerenciar.usuarios';</script>";						//aqui ele alterou o login			} 			else 			{							//aqui checa se existe o login				if ( mysql_num_rows( $existelogin ) > 1 ) 				{					$erro = "<br/>* <b>\"E-mail\"</b> j· existe!";				} 				else 				{									if ( $row->EMAIL == $email ) 					{											if( $isitem == '0' )						{							mysql_query("UPDATE login SET DTA='$dta', SENHA='$senha', STATUS='$status', OWNER='$_SESSION[CODPESSOA]', PAPEL='$administrador$gerente$guest' WHERE CODLOGIN='$codlogin'");						}						else						{							mysql_query("UPDATE login SET DTA='$dta', STATUS='$status', OWNER='$_SESSION[CODPESSOA]', PAPEL='$administrador$gerente$guest' WHERE CODLOGIN='$codlogin'");						}												mysql_query("UPDATE pessoa SET DTA=CURRENT_TIMESTAMP, NOME='$nome', OWNER='$_SESSION[CODPESSOA]' WHERE CODPESSOA IN( SELECT E.CODPESSOA FROM login_rel_pessoa as E WHERE E.CODLOGIN='$codlogin')");												echo "<script>alert('* ".getLabel('LABEL_EDIT_SUCESSO_LABEL', $_SESSION['LANGUAGE'])."!')</script>";						echo "<script>window.location = 'index.php?actionType=gerenciar.usuarios';</script>";										} 					else 					{											//aqui checa se trocou o cpf						if ( mysql_num_rows( $existemail ) != 0 ) {							$erro = "<br/>* <b>\"CPF\"</b> j· cadastrado!";						} 						else 						{													if( $isitem == '0' )							{								mysql_query("UPDATE login SET DTA='$dta', SENHA='$senha', STATUS='$status', OWNER='$_SESSION[CODPESSOA]', PAPEL='$administrador$gerente$guest' WHERE CODLOGIN='$codlogin'");							}							else							{								mysql_query("UPDATE login SET DTA='$dta', STATUS='$status', OWNER='$_SESSION[CODPESSOA]', PAPEL='$administrador$gerente$guest' WHERE CODLOGIN='$codlogin'");							}							mysql_query("UPDATE pessoa SET DTA=CURRENT_TIMESTAMP, NOME='$nome', OWNER='$_SESSION[CODPESSOA]' WHERE CODPESSOA IN( SELECT E.CODPESSOA FROM login_rel_pessoa as E WHERE E.CODLOGIN='$codlogin')");																				echo "<script>alert('* ".getLabel('LABEL_EDIT_SUCESSO_LABEL', $_SESSION['LANGUAGE'])."!')</script>";							echo "<script>window.location = 'index.php?actionType=gerenciar.usuarios';</script>";						}					}				} 					}		} 			} 	else 	{		$erro = getLabel('ERRO_PREENCHER_TODOS_CAMPOS', $_SESSION['LANGUAGE']);	}		$pi = "<form name='formCpf' method='post' action='index.php?actionType=gerenciar.usuarios.edit&id=$_GET[id]'>";					$pi .= "<div>";			$pi .= "<input type='hidden' name='CODLOGIN' value='$row->CODLOGIN'>";		$pi .= "</div>";		$pi .= "<div class='ErroMessage'>* $erro!</div>";				$pi .= "<div class='Userlabel'>".getLabel('LABEL_ULTIMA_ATUALIZACAO', $_SESSION['LANGUAGE']).": $row->DTA</div>";				$owner = mysql_query("SELECT login.LOGIN FROM login		INNER JOIN login_rel_pessoa ON login_rel_pessoa.CODLOGIN=login.CODLOGIN		WHERE login_rel_pessoa.CODPESSOA='$row->OWNER'");				$owner = mysql_fetch_object($owner);				$pi .= "<div class='Userlabel'>".getLabel('LABEL_CRIADO_POR', $_SESSION['LANGUAGE']).": $owner->LOGIN</div>";		$pi .= "<div class='Separador'></div>";		$pi .= "<div class='Userlabel'>".getLabel('LABEL_NAME', $_SESSION['LANGUAGE']).":</div>";		$pi .= "<div class='EntradaTextForm'>";			if ( !empty($_POST) && isset($_POST['ACTION']) )			{				$pi .= "<input class='LiloginText' type='text' id='nome' name='nome' value='".$_POST['nome']."' maxlength='70'/>";			} else {				$pi .= "<input class='LiloginText' type='text' id='nome' name='nome' value='$row->NOME' maxlength='70'/>";			}		$pi .= "</div>";		$pi .= "<div><br/></div>";		$pi .= "<div class='Userlabel'>Login:</div>";		$pi .= "<div class='EntradaTextForm'>";			$pi .= "$row->LOGIN";		$pi .= "</div>";				$pi .= "<div><br/></div>";		$pi .= "<div class='Userlabel'>".getLabel('LABEL_DESEJA_UPDATE_PASSWORD', $_SESSION['LANGUAGE'])."</div>";				$pi .= "<div><br/></div>";				$pi .= "<div>";			$pi .= "<input type='radio' name='ISITEM' value='1' onclick='actionItem(1)' checked='true'/> <span class='Userlabel'>".getLabel('LABEL_NAO', $_SESSION['LANGUAGE'])."</span><br/>";			$pi .= "<input type='radio' name='ISITEM' value='0' onclick='actionItem(2)'/> <span class='Userlabel'>".getLabel('LABEL_SIM', $_SESSION['LANGUAGE'])."</span><br/>";		$pi .= "</div>";				$pi .= "<div><br/></div>";				$pi .= "<div id='byitem' style='display: block;'>";					$pi .= "</div>";					$pi .= "<div id='bycodigo' style='display: none;'>";							$pi .= "<div class='Userlabel'>".getLabel('LABEL_SENHA', $_SESSION['LANGUAGE']).":</div>";			$pi .= "<div class='EntradaTextForm'>";				$pi .= "<input class='LiloginText' type='password' name='senha' value='' maxlength='40'/>";			$pi .= "</div>";						$pi .= "<div class='Userlabel'>".getLabel('LABEL_REPETIR_SENHA', $_SESSION['LANGUAGE']).":</div>";			$pi .= "<div class='EntradaTextForm'>";								$pi .= "<input class='LiloginText' type='password' name='repetirsenha' value='' maxlength='40'/>";			$pi .= "</div>";					$pi .= "</div>";				$pi .= "<div><br/></div>";						$pi .= "<div class='Userlabel'>E-mail:</div>";		$pi .= "<div class='EntradaTextForm'>";						if ( !empty($_POST) && isset($_POST['ACTION']) ) 			{ 				$pi .= "<input class='LiloginText' type='text' id='email' name='email' value='$_POST[email]' maxlength='70' onchange='caixaBaixa(this.id)' onkeypress='caixaBaixa(this.id)' readonly/>";			} 			else 			{				$pi .= "<input class='LiloginText' type='text' id='email' name='email' value='$row->EMAIL' maxlength='70' onchange='caixaBaixa(this.id)' onkeypress='caixaBaixa(this.id)' readonly/>";			}		$pi .= "</div>";		$pi .= "<div>";					if(!empty($_POST) && isset($_POST['ACTION']) )			{				( $_POST['status'] == 'on' ) ? $pi .= "<input type='checkbox' name='status' checked='true'/> <span class='Userlabel'>".getLabel('LABEL_ATIVO_TEXT', $_SESSION['LANGUAGE'])."</span>" : $pi .= "<input type='checkbox' name='status'/> <span class='Userlabel'>".getLabel('LABEL_ATIVO_TEXT', $_SESSION['LANGUAGE'])."</span>";			}			else			{				( $row->STATUS == '1' ) ? $pi .= "<input type='checkbox' name='status' checked='true'/> <span class='Userlabel'>".getLabel('LABEL_ATIVO_TEXT', $_SESSION['LANGUAGE'])."</span>" : $pi .= "<input type='checkbox' name='status'/> <span class='Userlabel'>".getLabel('LABEL_ATIVO_TEXT', $_SESSION['LANGUAGE'])."</span>";						}													$pi .= "</div>";		$pi .= "<div>";					( substr_count( $row->PAPEL, "GUEST") == 0 )			? $_POST['GUEST'] = ''			: $_POST['GUEST'] = 'on';							( substr_count( $row->PAPEL, "ADMINISTRADOR") == 0 )			? $_POST['ADMINISTRADOR'] = ''			: $_POST['ADMINISTRADOR'] = 'on';							( substr_count( $row->PAPEL, "GERENTE") == 0 )			? $_POST['GERENTE'] = ''			: $_POST['GERENTE'] = 'on';							( $_POST['ADMINISTRADOR'] == 'on') ? $pi .= "<input type='checkbox' name='ADMINISTRADOR' checked='true'/> <span class='Userlabel'>".getLabel('LABEL_ADMINISTRADOR', $_SESSION['LANGUAGE'])."</span>" : $pi .= "<input type='checkbox' name='ADMINISTRADOR'/> <span class='Userlabel'>".getLabel('LABEL_ADMINISTRADOR', $_SESSION['LANGUAGE'])."</span>";			( $_POST['GERENTE'] == 'on' ) ? $pi .= "<input type='checkbox' name='GERENTE' checked='true'/> <span class='Userlabel'>".getLabel('LABEL_GERENTE', $_SESSION['LANGUAGE'])."</span>" : $pi .= "<input type='checkbox' name='GERENTE'/> <span class='Userlabel'>".getLabel('LABEL_GERENTE', $_SESSION['LANGUAGE'])."</span>";			( $_POST['GUEST'] == 'on' ) ? $pi .= "<input type='checkbox' name='GUEST' checked='true'/> <span class='Userlabel'>GUEST</span>" : $pi .= "<input type='checkbox' name='GUEST'/> <span class='Userlabel'>".getLabel('LABEL_GUEST', $_SESSION['LANGUAGE'])."</span>";					$pi .= "</div>";		$pi .= "<div style='margin-bottom: 3%;'></div>";		$pi .="<div><input type='hidden' name='ACTION' value='ACTION'/></div>";		//$pi .="<div><input class='BtnProprio' type='submit' value='".getLabel('LABEL_ENVIAR', $_SESSION['LANGUAGE'])."'/></div>";		$pi .= "<div><br/></div>";			$pi .= "</form>";?>